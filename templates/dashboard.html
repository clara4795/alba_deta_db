<!DOCTYPE html>
<html>
<head>
    <title>ì•Œë°” ìŠ¤ì¼€ì¤„ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        
        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar-container { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-width: 1000px; }
        .day-header { background-color: #333; color: white; padding: 10px; text-align: center; font-weight: bold; }
        .day-cell { border: 1px solid #ddd; min-height: 120px; padding: 5px; background-color: #fff; vertical-align: top; }
        .day-number { font-weight: bold; margin-bottom: 5px; display: block; }
        .empty-cell { background-color: #f9f9f9; }

        /* ìŠ¤ì¼€ì¤„ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .schedule-item {
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 6px;
            padding: 5px;
            margin-bottom: 4px;
            font-size: 0.85em;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .store-name { font-weight: bold; color: #333; }
        .work-time { color: #555; margin-bottom: 2px;}

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-sm { border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em; padding: 4px 8px; width: 100%; margin-top: 3px; }
        .btn-request { background-color: #ff5252; color: white; }
        .btn-cancel { background-color: #90a4ae; color: white; }
        .btn-accept { background-color: #4caf50; color: white; }
        .btn-revert { background-color: #ef5350; color: white; }
        
        /* ìƒíƒœ ë±ƒì§€ */
        .badge { padding: 3px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold; display: inline-block;}
        .badge-green { background-color: #e8f5e9; color: #2e7d32; } /* ëª¨ì§‘ì¤‘ */
        .badge-yellow { background-color: #fff3e0; color: #ef6c00; } /* ìŠ¹ì¸ëŒ€ê¸° */
        .badge-gray { background-color: #eceff1; color: #607d8b; } /* ì™„ë£Œ */

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1000px; margin-bottom: 20px; }
        .nav-links a { text-decoration: none; font-size: 2em; color: #333; font-weight: bold; margin: 0 10px; }
    </style>
</head>
<body>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <script>
            {% for message in messages %} alert("{{ message }}"); {% endfor %}
        </script>
      {% endif %}
    {% endwith %}

    <div class="nav-container">
        <div style="display: flex; align-items: center;">
            <a href="{{ url_for('dashboard', year=prev_year, month=prev_month, store_id=current_store_id) }}">&lt;</a>
            
            <h1 style="margin: 0 15px;">ğŸ“… {{ year }}ë…„ {{ month }}ì›”</h1>
            
            <a href="{{ url_for('dashboard', year=next_year, month=next_month, store_id=current_store_id) }}">&gt;</a>
        </div>

        <div style="font-size: 1.2em; font-weight: bold; color: #2e7d32; background-color: #e8f5e9; padding: 5px 10px; border-radius: 5px; display: inline-block;">
                ğŸ’° ì´ë²ˆ ë‹¬ ì˜ˆìƒ ê¸‰ì—¬: {{ total_salary }}ì›
        </div>

        <form action="{{ url_for('dashboard') }}" method="get">
            <input type="hidden" name="year" value="{{ year }}">
            <input type="hidden" name="month" value="{{ month }}">
            
            <select name="store_id" onchange="this.form.submit()" style="padding: 8px; font-size: 1em; border-radius: 4px;">
                <option value="">ğŸª ëª¨ë“  ë§¤ì¥ ë³´ê¸°</option>
                {% for store in my_stores %}
                    <option value="{{ store[0] }}" {% if current_store_id == store[0] %}selected{% endif %}>
                        {{ store[1] }}
                    </option>
                {% endfor %}
            </select>
        </form>

    </div>

    <div class="calendar-container">
        <div class="day-header">ì›”</div><div class="day-header">í™”</div><div class="day-header">ìˆ˜</div>
        <div class="day-header">ëª©</div><div class="day-header">ê¸ˆ</div><div class="day-header">í† </div>
        <div class="day-header">ì¼</div>

        {% for week in calendar_matrix %}
            {% for day in week %}
                {% if day == 0 %}
                    <div class="day-cell empty-cell"></div>
                {% else %}
                    <div class="day-cell">
                        <span class="day-number">{{ day }}</span>
                        
                        {% if day in schedule_map %}
                            {% for schedule in schedule_map[day] %}
                                
                                <div class="schedule-item" 
                                     style="background-color: {{ schedule.bg_color }}; 
                                            {% if schedule.type == 'pending' %} opacity: 0.6; border: 2px dashed #999; {% endif %}">
                                    
                                    <div class="store-name">
                                        {% if schedule.type == 'pending' %}(ëŒ€ê¸°){% endif %} 
                                        {{ schedule.store_name }}
                                    </div>
                                    <div class="work-time">{{ schedule.time_str }}</div>

                                    <div>
                                        {% if schedule.type == 'pending' %}
                                            <form action="{{ url_for('cancel_accept', deta_id=schedule.deta_id) }}" method="post">
                                                <button class="btn-sm btn-revert" onclick="return confirm('ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">â†©ï¸ ìˆ˜ë½ ì·¨ì†Œ</button>
                                            </form>

                                        {% else %}
                                            {% if schedule.status == 'ì—†ìŒ' %}
                                                <form action="{{ url_for('request_deta', schedule_id=schedule.id) }}" method="post">
                                                    <button class="btn-sm btn-request" onclick="return confirm('ëŒ€íƒ€ë¥¼ êµ¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ“¢ ëŒ€íƒ€ êµ¬í•¨</button>
                                                </form>
                                            {% elif schedule.status == 'êµ¬í•˜ëŠ”ì¤‘' %}
                                                <span class="badge badge-green">â³ êµ¬í•˜ëŠ” ì¤‘</span>
                                                <form action="{{ url_for('cancel_deta', schedule_id=schedule.id) }}" method="post">
                                                    <button class="btn-sm btn-cancel" onclick="return confirm('ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">âŒ ìš”ì²­ ì·¨ì†Œ</button>
                                                </form>
                                            {% elif schedule.status == 'ìŠ¹ì¸ëŒ€ê¸°' %}
                                                <span class="badge badge-yellow">ğŸ”’ ìŠ¹ì¸ ëŒ€ê¸°ì¤‘</span>
                                            {% else %}
                                                <span class="badge badge-gray">{{ schedule.status }}</span>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        {% endfor %}
    </div>

     <div style="max-width: 1000px; margin-top: 40px; border-top: 2px solid #eee; padding-top: 20px;">
        
        <h2>ğŸ“‹ {{ current_store_name }} ëŒ€íƒ€ í˜„í™©</h2>
        
        <table style="width: 100%; border-collapse: collapse; text-align: center; font-size: 0.9em;">
            <tr style="background-color: #f5f5f5; border-bottom: 2px solid #ddd;">
                <th style="padding: 10px;">ìƒíƒœ</th>
                <th>ë§¤ì¥</th>
                <th>ë‚ ì§œ</th>   <th>ì‹œê°„</th>   <th>ìš”ì²­ì</th> <th>ìˆ˜ë½ì</th> <th>ê´€ë¦¬</th>
            </tr>

            {% if all_requests %}
                {% for req in all_requests %}
                <tr style="border-bottom: 1px solid #eee; height: 50px;">
                    <td>
                        {% if req[8] == 'êµ¬í•˜ëŠ”ì¤‘' %} <span class="badge badge-green">ğŸŸ¢ ëª¨ì§‘ì¤‘</span>
                        {% elif req[8] == 'ìŠ¹ì¸ëŒ€ê¸°' %} <span class="badge badge-yellow">ğŸŸ¡ ìŠ¹ì¸ëŒ€ê¸°</span>
                        {% else %} <span class="badge badge-gray">âšª {{ req[8] }}</span>
                        {% endif %}
                    </td>
                    
                    <td>{{ req[3] }}</td>
                    
                    <td style="color: #333; font-weight: bold;">
                        {{ req[6].strftime('%Y-%m-%d') }}
                    </td>

                    <td style="color: #555;">
                        {{ req[6].strftime('%H:%M') }} ~ {{ req[7].strftime('%H:%M') }}
                    </td>

                    <td>{{ req[4] }}</td>

                    <td>
                        {% if req[5] %}
                            <span style="color: #2e7d32; font-weight: bold;">{{ req[5] }}</span>
                        {% else %}
                            <span style="color: #ccc;">-</span>
                        {% endif %}
                    </td>

                    <td>
                        {% if req[8] == 'êµ¬í•˜ëŠ”ì¤‘' and req[9] != user_id %}
                            <form action="{{ url_for('accept_deta', deta_id=req[0], schedule_id=req[1]) }}" method="post">
                                <button class="btn-sm btn-accept" style="width: auto;" onclick="return confirm('ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ™†â€â™‚ï¸ ìˆ˜ë½</button>
                            </form>
                        
                        {% elif req[8] == 'êµ¬í•˜ëŠ”ì¤‘' and req[9] == user_id %}
                             <span style="color: #2196F3;">(ë‚´ ìš”ì²­)</span>

                        {% elif req[8] == 'ìŠ¹ì¸ëŒ€ê¸°' %}
                             <span style="color: #ef6c00;">ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr><td colspan="7" style="padding: 20px; color: #999;">ëŒ€íƒ€ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            {% endif %}
        </table>
    </div>

   
    <br><br>
    <a href="/" style="color: #666; text-decoration: none;">ë¡œê·¸ì•„ì›ƒ</a>
</body>
</html>