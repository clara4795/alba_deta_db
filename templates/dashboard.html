<!DOCTYPE html>
<html>
<head>
    <title>ì•Œë°” ìŠ¤ì¼€ì¤„ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f6f8; }
        
        /* [ë ˆì´ì•„ì›ƒ] ë©”ì¸ ì»¨í…Œì´ë„ˆ (ì¢Œìš° ë¶„í• ) */
        .dashboard-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            align-items: flex-start; /* ìœ„ìª½ ì •ë ¬ */
        }

        /* ì™¼ìª½: ë‹¬ë ¥ ì˜ì—­ (ë¹„ìœ¨ 7) */
        .left-panel { flex: 7; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* ì˜¤ë¥¸ìª½: ëŒ€íƒ€ ë¦¬ìŠ¤íŠ¸ ì˜ì—­ (ë¹„ìœ¨ 3) */
        .right-panel { 
            flex: 3; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            max-height: 800px; /* ë†’ì´ ì œí•œ */
            overflow-y: auto;  /* ë‚´ìš© ë§ìœ¼ë©´ ìŠ¤í¬ë¡¤ */
        }

        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
        .day-header { background-color: #37474f; color: white; padding: 10px; text-align: center; font-weight: bold; border-radius: 4px; }
        .day-cell { border: 1px solid #eee; min-height: 120px; padding: 5px; background-color: #fff; vertical-align: top; border-radius: 4px; }
        .day-number { font-weight: bold; margin-bottom: 5px; display: block; color: #333; }
        .empty-cell { background-color: #fafafa; border: none; }

        /* ìŠ¤ì¼€ì¤„ ì•„ì´í…œ (ë‹¬ë ¥ ë‚´ë¶€) */
        .schedule-item {
            border-radius: 4px; padding: 5px; margin-bottom: 4px; font-size: 0.85em;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1); color: #333;
        }
        .store-name { font-weight: bold; }
        
        /* ëŒ€íƒ€ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ ìŠ¤íƒ€ì¼ (ì˜¤ë¥¸ìª½ íŒ¨ë„ìš©) */
        .request-card {
            border: 1px solid #eee;
            border-left: 4px solid #ddd; /* ìƒíƒœë³„ ìƒ‰ìƒ ë“¤ì–´ê°ˆ ê³³ */
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            background-color: #fff;
            transition: transform 0.2s;
        }
        .request-card:hover { transform: translateY(-2px); box-shadow: 0 3px 6px rgba(0,0,0,0.1); }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .card-store { font-weight: bold; font-size: 1.1em; color: #333; }
        .card-time { color: #555; font-size: 0.9em; margin-bottom: 5px; }
        .card-people { font-size: 0.85em; color: #777; margin-bottom: 10px; }
        
        /* ë²„íŠ¼ ê³µí†µ */
        button { cursor: pointer; border: none; border-radius: 4px; padding: 4px 8px; width: 100%; font-weight: bold; transition: background 0.2s; font-size: 0.85em; }
        .btn-request { background-color: #ff7043; color: white; } /* ì£¼í™© */
        .btn-cancel { background-color: #b0bec5; color: white; } /* íšŒìƒ‰ */
        .btn-accept { background-color: #66bb6a; color: white; } /* ì´ˆë¡ */
        .btn-revert { background-color: #ef5350; color: white; } /* ë¹¨ê°• */
        button:hover { opacity: 0.9; }

        /* ë±ƒì§€ */
        .badge { padding: 3px 8px; border-radius: 12px; font-size: 0.75em; font-weight: bold; }
        .badge-green { background-color: #e8f5e9; color: #2e7d32; }
        .badge-yellow { background-color: #fff3e0; color: #ef6c00; }
        .badge-gray { background-color: #eceff1; color: #607d8b; }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .nav-btn { text-decoration: none; font-size: 1.5em; color: #555; padding: 0 10px; }
    </style>
</head>
<body>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <script>
            {% for message in messages %} alert("{{ message }}"); {% endfor %}
        </script>
      {% endif %}
    {% endwith %}

    <div class="dashboard-container">
        
        <div class="left-panel">
            <div class="nav-container">
                <div style="display: flex; align-items: center;">
                    <a href="{{ url_for('dashboard', year=prev_year, month=prev_month, store_id=current_store_id) }}" class="nav-btn">&lt;</a>
                    <h2 style="margin: 0 10px; color: #333;">ğŸ“… {{ year }}ë…„ {{ month }}ì›”</h2>
                    <a href="{{ url_for('dashboard', year=next_year, month=next_month, store_id=current_store_id) }}" class="nav-btn">&gt;</a>
                </div>
                
                <div style="text-align: right;">
                    <form action="{{ url_for('dashboard') }}" method="get" style="display: inline-block; margin-right: 10px;">
                        <input type="hidden" name="year" value="{{ year }}">
                        <input type="hidden" name="month" value="{{ month }}">
                        <select name="store_id" onchange="this.form.submit()" style="padding: 6px; border-radius: 4px; border: 1px solid #ccc;">
                            <option value="">ğŸª ëª¨ë“  ë§¤ì¥ ë³´ê¸°</option>
                            {% for store in my_stores %}
                                <option value="{{ store[0] }}" {% if current_store_id == store[0] %}selected{% endif %}>
                                    {{ store[1] }}
                                </option>
                            {% endfor %}
                        </select>
                    </form>
                    <div style="display: inline-block; background: #e8f5e9; color: #2e7d32; padding: 6px 12px; border-radius: 20px; font-weight: bold; font-size: 0.9em;">
                        ğŸ’° ì´ë²ˆ ë‹¬ ì˜ˆìƒ ê¸‰ì—¬: {{ total_salary }}ì›
                    </div>
                </div>
            </div>

            <div class="calendar-grid">
                <div class="day-header">ì›”</div><div class="day-header">í™”</div><div class="day-header">ìˆ˜</div>
                <div class="day-header">ëª©</div><div class="day-header">ê¸ˆ</div><div class="day-header">í† </div>
                <div class="day-header">ì¼</div>

                {% for week in calendar_matrix %}
                    {% for day in week %}
                        {% if day == 0 %}
                            <div class="day-cell empty-cell"></div>
                        {% else %}
                            <div class="day-cell">
                                <span class="day-number">{{ day }}</span>
                                {% if day in schedule_map %}
                                    {% for schedule in schedule_map[day] %}
                                        <div class="schedule-item" 
                                             style="background-color: {{ schedule.bg_color }}; 
                                                    {% if schedule.type == 'pending' %} opacity: 0.6; border: 2px dashed #999; {% endif %}">
                                            
                                            <div class="store-name">
                                                {% if schedule.type == 'pending' %}(ìŠ¹ì¸ ëŒ€ê¸°){% endif %} 
                                                {{ schedule.store_name }}
                                            </div>
                                            <div style="font-size: 0.8em; margin: 3px 0;">{{ schedule.time_str }}</div>
                                            

                                            {% if schedule.type == 'pending' %}
                                                <form action="{{ url_for('cancel_accept', deta_id=schedule.deta_id) }}" method="post">
                                                    <button class="btn-revert" onclick="return confirm('ëŒ€íƒ€ ìˆ˜ë½ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">â†©ï¸ ìˆ˜ë½ ì·¨ì†Œ</button>
                                                </form>
                                            {% else %}
                                                {% if schedule.status == 'ì—†ìŒ' %}
                                                    <form action="{{ url_for('request_deta', schedule_id=schedule.id) }}" method="post">
                                                        <button class="btn-request" onclick="return confirm('ëŒ€íƒ€ë¥¼ ìš”ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ“¢ ëŒ€íƒ€ êµ¬í•¨</button>
                                                    </form>
                                                {% elif schedule.status == 'êµ¬í•˜ëŠ”ì¤‘' %}
                                                    <span class="badge badge-green">â³ ëª¨ì§‘ì¤‘</span>
                                                    <form action="{{ url_for('cancel_deta', schedule_id=schedule.id) }}" method="post" style="margin-top:3px;">
                                                        <button class="btn-cancel" onclick="return confirm('ëŒ€íƒ€ ìš”ì²­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">âŒ ìš”ì²­ ì·¨ì†Œ</button>
                                                    </form>
                                                {% elif schedule.status == 'ìŠ¹ì¸ëŒ€ê¸°' %}
                                                    <span class="badge badge-yellow">ğŸ”’ ìŠ¹ì¸ëŒ€ê¸°</span>
                                                {% elif schedule.status == 'ì™„ë£Œ' %}
                                                    <span class="badge badge-gray">ë³€ê²½ ì™„ë£Œ</span>
                                                {% else %}
                                                    <span class="badge badge-gray">{{ schedule.status }}</span>
                                                {% endif %}
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                {% endif %}
                            </div>
                        {% endif %}
                    {% endfor %}
                {% endfor %}
            </div>
        </div>

        <div class="right-panel">
            <h3 style="margin-top: 0; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px;">
                ğŸ“‹ {{ current_store_name }} ëŒ€íƒ€ í˜„í™©
            </h3>
            
            {% if all_requests %}
                {% for req in all_requests %}
                <div class="request-card" 
                     style="border-left-color: {% if req[8] == 'êµ¬í•˜ëŠ”ì¤‘' %}#4caf50{% elif req[8] == 'ìŠ¹ì¸ëŒ€ê¸°' %}#ff9800{% else %}#9e9e9e{% endif %};">
                    
                    <div class="card-header">
                        <span class="card-store">{{ req[3] }}</span>
                        {% if req[8] == 'êµ¬í•˜ëŠ”ì¤‘' %} <span class="badge badge-green">ğŸŸ¢ ëª¨ì§‘ì¤‘</span>
                        {% elif req[8] == 'ìŠ¹ì¸ëŒ€ê¸°' %} <span class="badge badge-yellow">ğŸŸ¡ ìŠ¹ì¸ëŒ€ê¸°</span>
                        {% else %} <span class="badge badge-gray">âšª {{ req[8] }}</span>
                        {% endif %}
                    </div>

                    <div class="card-time">
                        ğŸ“… <b>{{ req[6].strftime('%mì›” %dì¼') }}</b><br>
                        â° {{ req[6].strftime('%H:%M') }} ~ {{ req[7].strftime('%H:%M') }}
                    </div>

                    <div class="card-people">
                        ğŸ—£ï¸ ìš”ì²­: <b>{{ req[4] }}</b> 
                        {% if req[5] %} <br>ğŸ‘‰ ìˆ˜ë½: <b>{{ req[5] }}</b> {% endif %}
                    </div>

                    {% if req[8] == 'êµ¬í•˜ëŠ”ì¤‘' and req[9] != user_id %}
                        <form action="{{ url_for('accept_deta', deta_id=req[0], schedule_id=req[1]) }}" method="post">
                            <button class="btn-accept" onclick="return confirm('ëŒ€íƒ€ë¥¼ ìˆ˜ë½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ğŸ™†â€â™‚ï¸ ì œê°€ í• ê²Œìš”!</button>
                        </form>
                    {% elif req[8] == 'êµ¬í•˜ëŠ”ì¤‘' and req[9] == user_id %}
                        <div style="text-align: center; color: #2196F3; font-size: 0.9em; font-weight: bold; background: #e3f2fd; padding: 5px; border-radius: 4px;">
                            (ë‚´ê°€ ì˜¬ë¦° ìš”ì²­)
                        </div>
                    {% elif req[8] == 'ìŠ¹ì¸ëŒ€ê¸°' %}
                            {% if req[10] == 'ë§¤ë‹ˆì €' or req[10] == 'ì‚¬ì¥ë‹˜' %}
                                <form action="{{ url_for('approve_deta', deta_id=req[0], schedule_id=req[1]) }}" method="post">
                                    <button class="btn-accept" style="background-color: #fe663c;" onclick="return confirm('ìµœì¢… ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ìŠ¤ì¼€ì¤„ì´ ë³€ê²½ë©ë‹ˆë‹¤.')">
                                        âœ… ëŒ€íƒ€ ìŠ¹ì¸
                                    </button>
                                </form>
                            {% else %}
                                <div style="text-align: center; color: #ff9800; font-size: 0.9em; border: 1px dashed #ff9800; padding: 5px; border-radius: 4px;">
                                    ğŸ”’ ë§¤ë‹ˆì € ìŠ¹ì¸ ëŒ€ê¸°ì¤‘
                                </div>
                            {% endif %}
                            
                        {% elif req[8] == 'ì™„ë£Œ' %}
                            <div style="text-align: center; color: #999; font-size: 0.9em;">
                                âœ¨ ë³€ê²½ ì™„ë£Œë¨
                            </div>
                        {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div style="text-align: center; color: #999; padding: 20px;">
                    ì˜¬ë¼ì˜¨ ëŒ€íƒ€ ìš”ì²­ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>
            {% endif %}
        </div>

    </div> <div style="text-align: center; margin-top: 20px;">
        <a href="/" style="color: #666; text-decoration: none;">ë¡œê·¸ì•„ì›ƒ</a>
    </div>

</body>
</html>