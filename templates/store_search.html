{% extends "base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 40px auto;">
    
    <div style="text-align: center; margin-bottom: 30px;">
        <h2 style="color: #37474f;">ğŸ” ë§¤ì¥ ì°¾ê¸° ë° ë“±ë¡</h2>
        
        <form action="{{ url_for('store_search') }}" method="get" style="margin: 20px 0;">
            <input type="text" name="q" value="{{ keyword }}" placeholder="ë§¤ì¥ ì´ë¦„ ë˜ëŠ” ì£¼ì†Œ ê²€ìƒ‰" 
                   style="padding: 10px; width: 300px; border: 1px solid #ccc; border-radius: 4px;">
            <button type="submit" style="padding: 10px 20px; background: #37474f; color: white; border: none; border-radius: 4px; cursor: pointer;">ê²€ìƒ‰</button>
        </form>

        <button onclick="document.getElementById('createStoreModal').showModal()" 
                style="background: none; border: none; color: #3f51b5; font-weight: bold; cursor: pointer; font-size: 1em; text-decoration: underline;">
            + ìƒˆë¡œìš´ ë§¤ì¥ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
        </button>
    </div>

    <ul style="list-style: none; padding: 0;">
        {% for store in stores %}
        <li style="background: white; padding: 20px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-size: 1.2em; font-weight: bold; color: #1a237e;">{{ store[1] }}</div>
                <div style="color: #666; font-size: 0.9em;">ğŸ“ {{ store[2] }}</div>
            </div>

            <div>
                {% if store[0] in my_joined_ids %}
                    <span style="color: #4caf50; font-weight: bold; margin-right: 10px;">âœ” ê°€ì…ë¨</span>
                {% else %}
                    <button onclick="openJoinModal('{{ store[0] }}', '{{ store[1] }}')" 
                            style="background-color: #3f51b5; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 14px;">
                        ê°€ì…í•˜ê¸°
                    </button>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
</div>

<dialog id="createStoreModal" style="border: none; border-radius: 10px; padding: 30px; width: 400px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
    <h3 style="margin-top: 0; color: #1a237e;">ğŸª ìƒˆ ë§¤ì¥ ë“±ë¡</h3>
    <p style="color: #666; font-size: 0.9em; margin-bottom: 20px;">ë§¤ì¥ì„ ë“±ë¡í•˜ë©´ ìë™ìœ¼ë¡œ ì‚¬ì¥ë‹˜ ê¶Œí•œì„ ê°–ìŠµë‹ˆë‹¤.</p>
    
    <form action="{{ url_for('create_store') }}" method="post">
        <label style="font-weight: bold; font-size: 0.9em;">ë§¤ì¥ëª…</label>
        <input type="text" name="name" required placeholder="ì˜ˆ: ìŠ¤íƒ€ë²…ìŠ¤ ë¶€ì‚°ëŒ€ì " 
               style="width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ddd; border-radius: 4px;">
        
        <label style="font-weight: bold; font-size: 0.9em;">ì£¼ì†Œ</label>
        <input type="text" name="address" required placeholder="ìƒì„¸ ì£¼ì†Œ" 
               style="width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ddd; border-radius: 4px;">
        
        <label style="font-weight: bold; font-size: 0.9em;">ê´€ë¦¬ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" name="password" required placeholder="ì§ì› ê°€ì…ìš© ë¹„ë°€ë²ˆí˜¸" 
               style="width: 100%; padding: 10px; margin: 5px 0 20px 0; border: 1px solid #ddd; border-radius: 4px;">
        
        <div style="text-align: right; display: flex; gap: 10px; justify-content: flex-end;">
            <button type="button" onclick="document.getElementById('createStoreModal').close()" 
                    style="background: #eee; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">ì·¨ì†Œ</button>
            <button type="submit" 
                    style="background: #3f51b5; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;">ë“±ë¡í•˜ê¸°</button>
        </div>
    </form>
</dialog>

<dialog id="joinModal" style="border: none; border-radius: 10px; padding: 20px; width: 300px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
    <h3 id="modalStoreName" style="margin-top: 0; color: #333;"></h3>
    <p style="font-size: 0.9em; color: #666;">ë§¤ì¥ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ì¦‰ì‹œ ê°€ì…ë©ë‹ˆë‹¤.</p>
    
    <form id="joinForm" method="post">
        <input type="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required 
               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 15px;">
        
        <div style="text-align: right;">
            <button type="button" onclick="document.getElementById('joinModal').close()" style="background: #ddd; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-right: 5px;">ì·¨ì†Œ</button>
            <button type="submit" style="background: #3f51b5; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer;">ê°€ì…</button>
        </div>
    </form>
</dialog>

<script>
    function openJoinModal(storeId, storeName) {
        document.getElementById('modalStoreName').innerText = storeName + " ê°€ì…";
        document.getElementById('joinForm').action = "/join_store_with_pw/" + storeId;
        document.getElementById('joinModal').showModal();
    }
</script>
{% endblock %}